## ----setup, include=FALSE-------------------------------------------------------------------------------------------------------------------------------------------------
knitr::opts_chunk$set(echo = TRUE)


## ----echo=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------
df = read.csv("https://vincentarelbundock.github.io/Rdatasets/csv/DAAG/ais.csv",stringsAsFactors = T)
df = df[,-1]
knitr::kable(head(df[,1:6],2))
knitr::kable(head(df[,7:13],2))


## ----include=F------------------------------------------------------------------------------------------------------------------------------------------------------------
df = df[,-c(12,13)]
head(df)


## ----echo=F,out.width="60%",fig.align='center',fig.cap="Pair Plot"--------------------------------------------------------------------------------------------------------
pairs(df[,1:4])


## ----echo=F,out.width="60%",fig.align='center',fig.cap="Pair Plot"--------------------------------------------------------------------------------------------------------
pairs(df[,5:8])


## ----echo=F,out.width="60%",fig.align='center',fig.cap="Pair Plot"--------------------------------------------------------------------------------------------------------
pairs(df[,9:11])


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
scaled_df = scale(df,center=TRUE,scale=TRUE)
cov = cov(scaled_df)
eig = eigen(cov)


## ----echo=F---------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eig$values)


## ----echo=F---------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(t(cumsum(eig$values*100/sum(eig$values))))


## ----echo=F,out.width="50%",fig.align='center',fig.cap="Scree Plot"-------------------------------------------------------------------------------------------------------
barplot(eig$values, names.arg=seq(1,11,1), main = "Scree Plot")


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
PC = scaled_df%*%eig$vectors
knitr::kable(head(PC[,1:7],4))


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(robustX)
out = mvBACON(scaled_df)
robust_df = scaled_df[out$subset,]


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eig_pr = eigen(cov(robust_df))
knitr::kable(eig_pr$values)


## ----echo=F,out.width="50%",fig.align='center',fig.cap="Scree Plot"-------------------------------------------------------------------------------------------------------
barplot(eig_pr$values[1:11], names.arg=seq(1,11,1), main = "Scree Plot")


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(t(cumsum(eig_pr$values*100/sum(eig_pr$values))))


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
robustPC = robust_df%*%eig_pr$vectors
knitr::kable(head(robustPC[,1:7],4))


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
B = scaled_df%*%t(scaled_df)


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eig_B = eigen(B)


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
W = eig_B$vec[,1:11]%*%diag(sqrt(abs(eig_B$val[1:11])))


## ----echo=F,out.width="50%",fig.align='center',fig.cap="Scree Plot"-------------------------------------------------------------------------------------------------------
barplot(eig_B$values[1:11], names.arg=seq(1,11,1), main = "Scree Plot")


## ----echo=F---------------------------------------------------------------------------------------------------------------------------------------------------------------
cumsum(eig_B$values[1:11]*100/sum(eig_B$values[1:11]))


## ----echo=F---------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(head(W[,1:7],4))


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Brobust = robust_df%*%t(robust_df)


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eig_Br = eigen(Brobust)
knitr::kable(eig_Br$values)


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Wrobust = eig_Br$vec[,1:11]%*%diag(sqrt(abs(eig_Br$val[1:11])))


## ----echo=F,out.width="50%",fig.align='center',fig.cap="Scree Plot"-------------------------------------------------------------------------------------------------------
barplot(eig_Br$values[1:11], names.arg=seq(1,11,1), main = "Scree Plot")


## ----echo=F---------------------------------------------------------------------------------------------------------------------------------------------------------------
cumsum(eig_Br$values[1:11]*100/sum(eig_Br$values[1:11]))


## ----echo=F---------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(head(Wrobust[,1:7],4))


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
n=202
eig$values*(n-1)


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eig_B$values[1:11]


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
pairs(df)

